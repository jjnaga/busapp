<!-- Drawer keeps mobile experience intact while adapting to a desktop rail. -->
<div #drawerContainer [ngClass]="drawerContainerClasses$ | async">
  <ng-container *ngIf="isMobile$ | async as isMobile">
    <div class="flex h-full flex-col">
      <!-- Combined header handles drag gestures on mobile and remains static on desktop. -->
      <div
        class="flex min-h-[48px] flex-col gap-1 border-b border-gray-700 bg-gradient-to-r from-gray-800 to-gray-900 px-4 py-3"
        [class.cursor-pointer]="isMobile" (click)="isMobile ? toggleDrawer() : null"
        (touchstart)="isMobile ? onTouchStart($event) : null" (touchmove)="isMobile ? onTouchMove($event) : null"
        (touchend)="isMobile ? onTouchEnd() : null">
        <div *ngIf="isMobile" class="-mb-1 flex justify-center">
          <div class="h-1.5 w-12 rounded-full bg-gradient-to-r from-gray-600 to-blue-500/50"></div>
        </div>

        <div class="flex items-center justify-between">
          <ng-container *ngIf="drawerMode$ | async as mode">
            <h3 class="flex-1 overflow-hidden whitespace-nowrap text-xl font-semibold text-gray-100">
              <ng-container
                *ngIf="mode === DrawerMode.Home && (selectedStop$ | async) as selectedStop; else defaultTitle">
                <stop-name [stopId]="selectedStop.stopId" [defaultName]="selectedStop.stopName || ''"></stop-name>
              </ng-container>
              <ng-template #defaultTitle>
                <span appMarqueeIfOverflow class="inline-block">
                  {{ headerTitles[mode] }}
                </span>
              </ng-template>
            </h3>
          </ng-container>
          <button *ngIf="isMobile"
            class="rounded-md px-2 py-1 text-sm font-medium text-blue-400 transition-colors hover:bg-gray-800/50 hover:text-blue-300">
            {{ (drawerExpanded$ | async) ? 'Close' : 'Expand' }}
          </button>
        </div>
      </div>

      <ng-container *ngIf="isMobile; else desktopContent">
        <div
          [class]="'h-[' + DRAWER_CONSTANTS.MOBILE.CONTENT_HEIGHT_VH + 'vh] overflow-auto bg-gray-900 transition-all duration-300'">
          <ng-container [ngSwitch]="drawerMode$ | async">
            <ng-container *ngSwitchCase="DrawerMode.Favorites">
              <drawer-favorites></drawer-favorites>
            </ng-container>
            <ng-container *ngSwitchCase="DrawerMode.Home">
              <ng-container *ngIf="selectedStop$ | async; else homeView">
                <drawer-stop></drawer-stop>
              </ng-container>
              <ng-template #homeView>
                <drawer-home></drawer-home>
              </ng-template>
            </ng-container>
          </ng-container>
        </div>
        <bottom-menu></bottom-menu>
      </ng-container>

      <ng-template #desktopContent>
        <div class="flex-grow overflow-auto bg-gray-900">
          <ng-container [ngSwitch]="drawerMode$ | async">
            <ng-container *ngSwitchCase="DrawerMode.Favorites">
              <drawer-favorites></drawer-favorites>
            </ng-container>
            <ng-container *ngSwitchCase="DrawerMode.Home">
              <ng-container *ngIf="selectedStop$ | async; else homeViewDesktop">
                <drawer-stop></drawer-stop>
              </ng-container>
              <ng-template #homeViewDesktop>
                <drawer-home></drawer-home>
              </ng-template>
            </ng-container>
          </ng-container>
        </div>
        <bottom-menu></bottom-menu>
      </ng-template>
    </div>
  </ng-container>
</div>